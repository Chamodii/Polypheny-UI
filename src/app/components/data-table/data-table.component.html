<app-toast></app-toast>
<div *ngIf="!resultSet.data && !resultSet.error">data-table: nothing to show.</div>
<div class="text-danger mb-3" *ngIf="resultSet.error && !resultSet.header">{{resultSet.error}}</div>

<div class="row" *ngIf="resultSet.header">
  <div class="col-lg-12" id="data-table-wrapper">
    <table class="table table-hover table-sm table-bordered table-striped" [ngClass]="{'loading': loading}" id="data-table" [attr.data-table]="resultSet.table">
      <thead>
      <tr>
        <ng-container *ngFor="let h of resultSet.header">
          <th >{{h.name}}
            <a *ngIf="config.sort" [routerLink]="" [ngClass]="{'btn-primary' : h.sort.sorting, 'btn-light': !h.sort.sorting, 'btn btn-sm float-right': true}" (click)="sortTable(h.sort)">
              <i [ngClass]="h.sort.direction === 'ASC' ? 'icon-arrow-up' : 'icon-arrow-down'"></i>
            </a>
          </th>
        </ng-container>
        <th class="delete" *ngIf="config.delete">
          <!--<i class="cui-trash"></i>-->
        </th>
      </tr>
      </thead>
      <tbody>
      <tr *ngIf="config.search">
        <td *ngFor="let h of resultSet.header">
          <input *ngIf="_types.numericTypes().includes(h.dataType.toLowerCase())" type="number" class="form-control form-control-sm table-filter" placeholder="search" [attr.data-col]="h.name" [value]="h.filter" (keyup)="filterTable($event, filter1.value, h)" #filter1>
          <input *ngIf="! _types.numericTypes().includes(h.dataType.toLowerCase())" type="text" class="form-control form-control-sm table-filter" placeholder="search" [attr.data-col]="h.name" [value]="h.filter" (keyup)="filterTable($event, filter2.value, h)" #filter2 [ngClass]="isValidFilter(filter2.value,h)">
        </td>
        <td *ngIf="config.update || config.delete"></td>
      </tr>
      <tr *ngFor="let d1 of resultSet.data; let i = index" [ngClass]="{'editing': editing === i}">
        <ng-container *ngIf="editing === i">
          <td *ngFor="let d2 of d1; let i = index">
            <!--<input type="text" class="form-control form-control-sm editing" [value]="d2" [attr.data-before]="d2" [attr.data-col]="resultSet.header[i].name">-->
            <app-input class="editing" [header]="resultSet.header[i]" [value]="updateValues.get(resultSet.header[i].name)" (valueChange)="newUpdateValue(resultSet.header[i].name, $event)" (enter)="updateRow()" [attr.data-before]="d2" [attr.data-col]="resultSet.header[i].name"></app-input>
          </td>
          <td *ngIf="config.update || config.delete">
            <button class="btn btn-primary" id="editColSave" (click)="updateRow()"><i class="fa fa-save"></i></button>
          </td>
        </ng-container>
        <ng-container *ngIf="editing !== i">
          <td *ngFor="let d2 of d1" (dblclick)="triggerEditing(i)">{{d2}}</td>
          <td class="delete" *ngIf="config.update || config.delete">
            <i *ngIf="config.delete" [ngClass]="{ 'cui-trash': i!==confirm, 'fa fa-warning': i===confirm }" (click)="deleteRow(d1, i)" (mouseleave)="confirm = -1"></i>
          </td>
        </ng-container>
      </tr>
      <tr *ngIf="!resultSet.data || resultSet.data.length === 0">
        <td *ngIf="!resultSet.error" [attr.colspan]="resultSet.header.length+1" style="text-align: center" class="text-danger">(no data to show)</td>
        <td *ngIf="resultSet.error" [attr.colspan]="resultSet.header.length+1" style="text-align: center" class="text-danger">error while filtering table</td>
      </tr>
      <tr *ngIf="config.create" id="insertRow">
        <td *ngFor="let h of resultSet.header">
          <app-input [header]="h" [value]="insertValues.get(h.name)" (valueChange)="inputChange(h.name, $event)" (enter)="insertRow()"></app-input>
        </td>
        <td *ngIf="config.update || config.delete"><button id="addColumnBtn" class="btn btn-primary" (click)="insertRow()">+</button></td>
      </tr>
      </tbody>
    </table>
  </div>
</div>

<div class="row">
  <div class="col-lg-12">
    <nav aria-label="Page navigation example" class="float-right" *ngIf="resultSet.highestPage > 1">
      <ul class="pagination">
        <li *ngFor="let p of pagination" class="page-item" [ngClass]="{ 'disabled': p.disabled, 'active': p.active }">
          <a class="page-link" (click)="paginate(p)" [routerLink]="">{{p.label}}</a>
        </li>
      </ul>
    </nav>
  </div>
</div>
