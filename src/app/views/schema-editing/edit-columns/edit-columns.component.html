<app-toast></app-toast>
<div class="row">

  <div class="col-lg-12">

    <h5 *ngIf="tableId">{{tableId}}</h5>
    <span *ngIf="!tableId">Please select a table in the left sidebar to edit its columns.</span>

    <table class="table table-hover table-striped" *ngIf="resultSet">
      <thead>
        <tr>
          <th>name</th>
          <th>nullable</th>
          <th>type</th>
          <th>max-length</th>
          <th>default-value</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let col of resultSet.header; let i = index" (dblclick)="editCol(i)">
          <ng-container *ngIf="i === editColumn">
            <td class="editing">
              <input type="text" class="form-control form-control-sm editing" [(ngModel)]="col.name" [attr.data-before]="col.name" id="colName">
            </td>
            <td class="editing">
              <input type="checkbox" class="form-control form-control-sm editing" [(ngModel)]="col.nullable" id="nullable" [attr.data-before]="col.nullable">
            </td>
            <td class="editing">
              <select class="form-control form-control-sm editing" id="udt_name" [attr.data-before]="col.type" [(ngModel)]="col.type">
                <option *ngFor="let t of types" [value]="t" >{{t}}</option>
              </select>
              <!--<input class="form-control form-control-sm editing"
                     [typeahead]="types"
                     [typeaheadScrollable]="true"
                     [typeaheadOptionsInScrollableView]="5"
                     [(ngModel)]="d1[2]"
                     [ngModelOptions]="{standalone: true}"
                     id="udt_name"
                     [attr.data-before]="d1[2]">-->
            </td>
            <td class="editing">
              <input type="number" placeholder="max-length" [(ngModel)]="col.maxLength" class="form-control form-control-sm editing" id="max-length" [attr.data-before]="col.maxLength">
            </td>
            <td>
              <!--<input type="text" [(ngModel)]="col.defaultValue" class="form-control form-control-sm editing" id="defaultValue" [attr.data-before]="col.defaultValue">-->
              <div class="input-group editing">
                <ng-container [ngSwitch]="col.type">
                  <input *ngSwitchCase="'int8'" type="number" id="defaultValue" placeholder="default value" class="form-control form-control-sm editing" [(ngModel)]="col.defaultValue" [disabled]="col.defaultValue === null">
                  <input *ngSwitchCase="'int4'" type="number" id="defaultValue" placeholder="default value" class="form-control form-control-sm editing" [(ngModel)]="col.defaultValue" [disabled]="col.defaultValue === null">
                  <ng-container *ngSwitchCase="'bool'">
                    <div class="form-check form-check-inline">
                      <label *ngIf="col.defaultValue === null" class="form-check-label disabled editing" [for]="'default'+col.name">null&nbsp;</label>
                      <label *ngIf="col.defaultValue === true" class="form-check-label editing" [for]="'default'+col.name">true&nbsp;</label>
                      <label *ngIf="col.defaultValue === false" class="form-check-label editing" [for]="'default'+col.name">false&nbsp;</label>
                      <input type="checkbox" id="defaultValue" class="form-check-input editing" [(ngModel)]="col.defaultValue" [id]="'default'+col.name" [disabled]="col.defaultValue === null">
                    </div>
                  </ng-container>
                  <input *ngSwitchDefault type="text" id="defaultValue" placeholder="default value" class="form-control form-control-sm editing" [(ngModel)]="col.defaultValue" [disabled]="col.defaultValue === null">
                </ng-container>
                <div class="input-group-append editing">
                  <button class="btn btn-sm editing" [ngClass]="{'btn-primary': col.defaultValue === null, 'btn-light': col.defaultValue !== null}" (click)="triggerDefaultNull( col )">null</button>
                </div>
              </div>
            </td>
            <td class="editing"><button class="btn btn-primary editing" (click)="saveCol(col)"><i class="fa fa-save editing editColSave"></i></button></td>
          </ng-container>
          <ng-container *ngIf="i !== editColumn">
            <td>{{col.name}}</td>
            <td>{{col.nullable}}</td>
            <td>{{col.type}}</td>
            <td>{{col.maxLength}}</td>
            <td>{{col.defaultValue}}</td>
            <td class="delete"><i (click)="dropColumn(col, i)" (mouseleave)="confirm = -1" [ngClass]="{ 'cui-trash': i!==confirm, 'fa fa-warning': i===confirm }"></i></td>
          </ng-container>
        </tr>

        <tr>
          <td>
            <input type="text" class="form-control form-control-sm" name="columnName" placeholder="column name" [(ngModel)]="createColumn.name">
          </td>
          <td>
            <input type="checkbox" class="form-control form-control-sm" [(ngModel)]="createColumn.nullable">
          </td>
          <td>
            <select class="form-control form-control-sm" [(ngModel)]="createColumn.type">
              <option *ngFor="let t of types" [value]="t">{{t}}</option>
            </select>
            <!--<input class="form-control form-control-sm" placeholder="type"
                   [typeahead]="types"
                   [dropup]="true"
                   [typeaheadScrollable]="true"
                   [typeaheadOptionsInScrollableView]="5"
                   [(ngModel)]="test"
                   [ngModelOptions]="{standalone: true}">-->
          </td>
          <td>
            <input type="number" placeholder="max-length" class="form-control form-control-sm" [(ngModel)]="createColumn.maxLength">
          </td>
          <td>
            <div class="input-group">
              <ng-container [ngSwitch]="createColumn.type">
                <input *ngSwitchCase="'int8'" type="number" placeholder="default value" class="form-control form-control-sm" [(ngModel)]="createColumn.defaultValue" [disabled]="createColumn.defaultValue === null">
                <input *ngSwitchCase="'int4'" type="number" placeholder="default value" class="form-control form-control-sm" [(ngModel)]="createColumn.defaultValue" [disabled]="createColumn.defaultValue === null">
                <ng-container *ngSwitchCase="'bool'">
                  <div class="form-check form-check-inline">
                    <label *ngIf="createColumn.defaultValue === null" class="form-check-label disabled" [for]="'default'+createColumn.name">null&nbsp;</label>
                    <label *ngIf="createColumn.defaultValue === true" class="form-check-label" [for]="'default'+createColumn.name">true&nbsp;</label>
                    <label *ngIf="createColumn.defaultValue === false" class="form-check-label" [for]="'default'+createColumn.name">false&nbsp;</label>
                    <input type="checkbox" class="form-check-input" [(ngModel)]="createColumn.defaultValue" [id]="'default'+createColumn.name" [disabled]="createColumn.defaultValue === null">
                  </div>
                </ng-container>
                <input *ngSwitchDefault type="text" placeholder="default value" class="form-control form-control-sm" [(ngModel)]="createColumn.defaultValue" [disabled]="createColumn.defaultValue === null">
              </ng-container>
              <div class="input-group-append">
                <button class="btn btn-sm" [ngClass]="{'btn-primary': createColumn.defaultValue ===null, 'btn-light': createColumn.defaultValue !== null}" (click)="triggerDefaultNull( createColumn )">null</button>
              </div>
            </div>
          </td>
          <td>
            <a [routerLink]="" class="btn btn-primary" id="addColumnBtn" (click)="addColumn()">+</a>
          </td>
        </tr>
      </tbody>
    </table>

  </div>

</div>
